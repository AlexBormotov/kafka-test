# Система аналитики с Kafka и Redis

Этот проект демонстрирует реализацию отслеживания движения мыши с ограничением частоты событий (троттлингом), отправкой данных на сервер, и сохранением последней позиции мыши в Redis.

## Функциональность

- Отслеживание движения мыши с ограничением до одного события каждые 250 мс
- Получение координат курсора (clientX, clientY)
- Отправка координат в формате JSON на серверный endpoint
- Использование уникального идентификатора пользователя
- Публикация данных в топик Kafka
- Сохранение последней позиции мыши в Redis
- Возможность включения и отключения отслеживания

## Архитектура

Система состоит из следующих компонентов:
- **Веб-интерфейс** - отслеживает движения мыши и отправляет координаты 
- **Flask API** - принимает координаты и публикует их в Kafka
- **Kafka** - брокер сообщений для обработки событий
- **Redis** - хранит последнюю позицию мыши для быстрого доступа
- **Kafka-to-Redis** - консьюмер, сохраняющий данные из Kafka в Redis

## Структура проекта

- `app.py` - основное Flask-приложение с API-эндпоинтами
- `mouseTracker.js` - модуль для отслеживания движения мыши
- `direct-mouse-tracker.js` - модуль для прямой отправки на API-эндпоинт
- `kafka_to_redis_consumer.py` - консьюмер для сохранения данных в Redis
- `redis_tools.py` - утилита для работы с Redis
- `templates/` - HTML-шаблоны для веб-интерфейса
- `static/` - статические файлы CSS и JavaScript
- `docker-compose.yml` - файл для запуска всех компонентов в Docker

## Установка и запуск

### Запуск с помощью Docker Compose

1. Установите Docker и Docker Compose
2. Запустите все контейнеры:
```
docker-compose up -d
```

### Тестирование

После запуска системы вы можете:

1. Открыть веб-интерфейс по адресу http://localhost:8080
2. Нажать кнопку "Запустить отслеживание" или "Запустить прямое отслеживание"
3. Проверить, что координаты мыши успешно отправляются в API

### Проверка данных в Redis

Для просмотра последней позиции мыши в Redis:
```
docker-compose exec kafka-to-redis python redis_tools.py get
```

### Управление Redis через утилиту

Просмотр списка ключей:
```
docker-compose exec kafka-to-redis python redis_tools.py list
```

Установка значения:
```
docker-compose exec kafka-to-redis python redis_tools.py set my_key my_value
```

Удаление ключа:
```
docker-compose exec kafka-to-redis python redis_tools.py delete my_key
```

## Интеграция в свой проект

```javascript
import { initMouseTracker, stopMouseTracker } from './mouseTracker.js';

// Запуск отслеживания
initMouseTracker();

// Остановка отслеживания
stopMouseTracker();
```

## Настройка серверного endpoint

По умолчанию данные отправляются на `/api/coordinates`. Для изменения endpoint отредактируйте соответствующий URL в функции `sendCoordinates` файла `mouseTracker.js`.

## Примечание

Демонстрационная версия перехватывает запросы fetch для визуализации данных без реального сервера.
В продакшн-версии обязательно настройте соответствующий обработчик на серверной стороне.
